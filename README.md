# Calculating Near and Far UV Surface Brightness for Local Environments of Supernovae

### Project Description:

Using observations from [Galex] (http://galex.stsci.edu/), we calculate the the near and far UV surface brightness of variously sized regions surrounding supernova locations. We do this for supernova considered by [Friedman et al. 2015] (http://arxiv.org/abs/1408.0465), [Rigault et al. 2015] (https://arxiv.org/abs/1412.6501), and a number of group observed supernova. Results are found by summing over the number of photon counts in int type .fits files and removing the background signal given by the coresponding skybg files (A summary of different Galex data products can be found [on their website] (http://galex.stsci.edu/gr6/?page=ddfaq)).

For the Rigault 2015 supernova we consider a 2kpc radius region around each SN location. For the Friedman 2015 and group observed supernova, we consider 1 kpc radius region along with a 5 kpc radius region for comparison with [Kelly et al. 2015] (http://arxiv.org/abs/1410.0961).

### Code Overview:

##### Reproducing results

Results for each group of supernova are generated by seperate .ipynb files ("source files"), each following a similiar layout. When importing the necessary pakages, each of the source files imports a `surface_brightness` class from [surface_brightness.py] (https://github.com/mwvgroup/Surface-Brightness/blob/master/surface_brightness.py). This class handles the calculation of flux and surface brightness values along with the generation of output plots (I'll describe this in more detail later). To reproduce the results in this repository use, changes only have to be made to the appropriate source file. First set the value of parameters located after the comment `#Input / Output Information`. These parameters include:

* `input_data_table` : The file path of a .csv file containing the names, locations, and redshifts for each supernova of interest.

* `fits_directory` : A directory containing the .fits files used to calculate surface brightness vlaues. The script will automatically search through all sub directories. To change this behavior, alter the code following the comment `#Create a list of files to perform photometry on`.

* `output_file_name` : A keyword to be contained in the output file names. File extensions will be added on automatically.

* `sn_col_name` : The name of the column containing supernova names from `input_data_table` 
* `redshift_col_name` : The name of the column containing redshift values from `input_data_table` 
* `ra_col_name` : The name of the column containing right ascension values from `input_data_table` 
* `dec_col_name` : The name of the column containing declination values from `input_data_table` 

The rest of the code should run without any further changes. Fits files used to generate the results in this repository have been uploaded to Marduk at `/home/depot/WIYN/GALEX/fits files/`

##### How it works

The code begins by walking through the directory `fits_directory` and building a list of .fits files to be analyzed. Files are only added to this list if the filename contains either 'nd-int' or 'fd-int', distinguishing int type files with observations in the near and far UV respectively. After compiling the list, the script uses a .reg file to build a dictionary of redshifts and coordinates for each supernova of interest. The function `photometry` uses these coordinates to check each of the .fits files for an observed supernova and performs photometry using the [photutils package] (http://photutils.readthedocs.io/en/latest/).

The int type .fits files used in this project contain a circular collection of pixels corresponding to the observing telescope's field of view ([here is an example image] (https://github.com/mwvgroup/Surface-Brightness/blob/master/example.jpg)). All pixels outside this field of view are assigned a value of 0. If the photometry process returns 0, there is no immediate way of knowing if the corresponding supernova (and by extension the photometry aperture) is within the field of view. For such cases the script will use the method `surface_brightness.zero_check` to perform photometry on a secondary check file. By default, the check file used is an exp type .fits file where zero valued pixels only occur outside the field of view. If performing photometry on the check file yields a non-zero value, then the aperture is deemed to be within the telescope's field of view.

Using photometry results from the int file, the corresponding flux, luminosity, and surface brightness values are calculated and added to a table. If more than one .fits file contains a given supernova, only the surface brightness value with the smallest error is included. A seperate table is generated for the near and far UV and for each aperture size. These tables are then combined and saved to the working directory in bot a .csv and .fits format. In addition to these tables, another table is created listing int type files that are either missing exp type check files, or do not have a supernova in their field of view. These tables are similiarly combined and written to a .csv file. Using the 1kpc radius surface brightness values, the `create_plots` function is used to save logarithmic plots of surface brightness vs redshift to .pdf files. In total, four plots are saved corresponding to near or far UV surface brightness in units of (erg s-1 A-1 arcsec^-2) and (erg s-1 A-1 kpc^-2).

Detailed comments are contained within each .py and .ipynd file to provide a step by step outline on how the code works.

##### Calculating Surface brightness from Photometry values

Given a photometry value `photom`, the corresponding flux is given in (erg sec-1 cm-2 Ã…-1) by a conversion factor `flux_conv`

    flux = flux_conv * photom 

This conversion factor is given by the [Galex website] (http://asd.gsfc.nasa.gov/archive/galex/FAQ/counts_background.html) as  2.06 x 10-16 for near UV observations and 1.40 x 10-15 for the far UV. The Luminosity is given by the flux times the surface area.
Using the WMAP9 cosmology, 

    from astropy.cosmology import WMAP9 as cosmo
    import numpy as np
    
    ldist = cosmo.luminosity_distance(redshift).cgs.value
    lum = flux * 4 * np.pi * (ldist**2) 
    
To find surface brightness in the desired units, we convert from units of kpc^-2 to armin^-2 and then from arcmin^-2 to arcsec^-2

    arcmin = cosmo.kpc_comoving_per_arcmin(redshift).value**2 
    sbrightness = lum * arcmin / 3600

### Repository File List:

Seperate sub directories are assigned to each group of supernova (eg. results for SN from Rigault et al. 2015 are in the Rigault 2015 folder). Some important file paths are outlined below.

* surface_brightness.py: This file contains the definition of the `surface_brightness` class used to calculate surface brightness values and plot results.

* Friedman data table.csv: A table listing supernova considered in Friedman et al. 2015 along with redhsift and coordinate values.

* *kpc NUV/FUV plot (arcsec).pdf: A logarithmic plot showing surface brightness in units of (erg s-1 A-1 arcsec^-2) verses the redshift.

* *kpc NUV/FUV plot (kpc).pdf: A logarithmic plot of the values from Output NUV/FUV.csv showing surface brightness in units of (erg s-1 A-1 kpc^-2) verses the redshift.
