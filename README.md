# Calculating Near and Far UV Surface Brightness for Local Environments of Supernovae

This readme is incomplete / under construction

## Project Description:

Using observations from [Galex] (http://galex.stsci.edu/), we calculate the near and far UV surface brightness of variously sized regions surrounding supernova locations. We do this for supernova considered by [Friedman et al. 2015] (http://arxiv.org/abs/1408.0465), [Rigault et al. 2015] (https://arxiv.org/abs/1412.6501), and a number of group observed supernova. Results are found by summing over the photon counts in int type .fits files and removing the background signal given by the corresponding skybg files. For more information on these file types, a summary of Galex data products can be found on [the Galex website] (http://galex.stsci.edu/gr6/?page=ddfaq).

For the Rigault 2015 supernova we consider a 2kpc radius region around each SN location. For the Friedman 2015 and group observed supernova, we consider 1 kpc radius region along with a 5 kpc radius region for comparison with [Kelly et al. 2015] (http://arxiv.org/abs/1410.0961). These values are chosen so that results can be compared against the previously mentioned publications.

## Code Overview:

#### Reproducing results

Results for each group of supernova are generated by separate .ipynb files ("source files"). When importing the necessary packages, each of the source files imports a `surface_brightness` class from [surface_brightness.py] (https://github.com/mwvgroup/Surface-Brightness/blob/master/surface_brightness.py). This class handles the calculation of flux and surface brightness values along with the generation of output plots (I'll describe this class and how it works in more detail later). To reproduce the results in this repository, changes only have to be made to the appropriate source file. Begin by setting the value of parameters located after the comment `#Input / Output Information`. These parameters include:

* `input_data_table` : The file path of a .csv file containing the names, locations, and redshifts for each supernova of interest.

* `fits_directory` : A directory containing the .fits files used to calculate surface brightness values. The script will automatically search through all sub directories. To change this behavior, alter the code following the comment `#Create a list of files to perform photometry on`.

* `output_file_name` : A keyword to be contained in the output file names. File extensions will be added on automatically.

* `sn_col_name` : The name of the column containing supernova names from `input_data_table` 
* `redshift_col_name` : The name of the column containing redshift values from `input_data_table` 
* `ra_col_name` : The name of the column containing right ascension values from `input_data_table` 
* `dec_col_name` : The name of the column containing declination values from `input_data_table` 

The steps hold for any source file, and no further changes should be necessary. Fits files used to generate the results in this repository have been uploaded to Marduk at `/home/depot/WIYN/GALEX/fits files/`.

#### Initiating a [surface_brightness] (https://github.com/mwvgroup/Surface-Brightness/blob/master/surface_brightness.py) class

When creating new `surface_brightness` instance, two arguments should be provided. 

    brightness = surface_brightness(cord_dict={}, red_dict={})

The first argument is a dictionary of supernova coordinates stored as SkyCord objects `{'SN name' : SkyCord}`. The second is a dictionary of redshifts for each supernova stored as floats `{'SN name' : redshift}`. If the keys in both dictionaries do not match, a `ValueError` will be raised. After a `surface_brightness` class has been initiated, both dictionaries can be modified by changing the `.cord_dict` and `.red_dict` attributes respectively.

There are two methods you should know about:

`.create_tables(uv_type (str), directory (str), radius (float), print_progress = False)` 

This method begins by walking through the directory `directory` and building a list of .fits files to be analyzed. Files are only added to this list if the filename contains either 'nd-int' (if uv_type is set equal to 'NUV') or 'fd-int' (if uv_type is set equal to 'FUV'). These strings are used by Galex to distinguish int type files with observations in the near or far UV respectively. Using the coordinates in `.cord_dict`, each of the .fits files is checked for an observed supernova photometry is performed using the [photutils package] (http://photutils.readthedocs.io/en/latest/).

The int type .fits files used in this project contain a circular collection of pixels corresponding to the observing telescope's field of view ([here is an example image] (https://github.com/mwvgroup/Surface-Brightness/blob/master/example.jpg)). All pixels outside this field of view are assigned a value of 0. If the photometry process returns 0, there is no immediate way of knowing if the corresponding supernova (and by extension the photometry aperture) is within the field of view. For such cases the script will use the method `.zero_check` to perform photometry on a secondary check file. By default, the check file used is an exp type .fits file where zero valued pixels only occur outside the field of view. If performing photometry on the check file yields a non-zero value, then the aperture is deemed to be within the telescope's field of view.

Using photometry results from the int file, the corresponding flux, luminosity, and surface brightness values are calculated and added to a table. If more than one .fits file contains a given supernova, only the surface brightness value with the smallest error is included. A separate table is generated for the near and far UV and for each aperture size. These tables are then combined and saved to the working directory in bot a .csv and .fits format. In addition to these tables, another table is created listing int type files that are either missing exp type check files, or do not have a supernova in their field of view. These tables are similarly combined and written to a .csv file. Using the 1kpc radius surface brightness values, the `create_plots` function is used to save logarithmic plots of surface brightness vs redshift to .pdf files. In total, four plots are saved corresponding to near or far UV surface brightness in units of (erg s-1 A-1 arcsec^-2) and (erg s-1 A-1 kpc^-2).

Detailed comments are contained within each .py and .ipynd file to provide a step by step outline on how the code works.

#### Calculating Surface brightness from Photometry values

Given a photometry value `photom`, the corresponding flux is given in (erg sec-1 cm-2 Ã…-1) by a conversion factor `flux_conv`

    flux = flux_conv * photom 

This conversion factor is given by the [Galex website] (http://asd.gsfc.nasa.gov/archive/galex/FAQ/counts_background.html) as  2.06 x 10-16 for near UV observations and 1.40 x 10-15 for the far UV. The Luminosity is given by the flux times the surface area.
Using the WMAP9 cosmology, 

    from astropy.cosmology import WMAP9 as cosmo
    import numpy as np
    
    ldist = cosmo.luminosity_distance(redshift).cgs.value
    lum = flux * 4 * np.pi * (ldist**2) 
    
To find surface brightness in the desired units, we convert from units of kpc^-2 to armin^-2 and then from arcmin^-2 to arcsec^-2

    arcmin = cosmo.kpc_comoving_per_arcmin(redshift).value**2 
    sbrightness = lum * arcmin / 3600

## Repository File List:

Seperate sub directories are assigned to each group of supernova (eg. results for SN from Rigault et al. 2015 are in the Rigault 2015 folder). Some important file paths are outlined below.

* surface_brightness.py: This file contains the definition of the `surface_brightness` class used to calculate surface brightness values and plot results.

* Friedman data table.csv: A table listing supernova considered in Friedman et al. 2015 along with redhsift and coordinate values.

* *kpc NUV/FUV plot (arcsec).pdf: A logarithmic plot showing surface brightness in units of (erg s-1 A-1 arcsec^-2) verses the redshift.

* *kpc NUV/FUV plot (kpc).pdf: A logarithmic plot of the values from Output NUV/FUV.csv showing surface brightness in units of (erg s-1 A-1 kpc^-2) verses the redshift.
